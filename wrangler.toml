# =============================================================================
# WRANGLER CONFIGURATION
# =============================================================================
# Worker and deployment configuration for Cloudflare Workers.
#
# App configuration (APP_ID, API_ORIGIN) comes from .env files and is
# passed to the worker at deploy time via --var flags. This keeps all app
# config in .env files for consistency between development and production.
#
# To deploy: pnpm cf-deploy production
# =============================================================================

name = "simpletodo"
main = "worker.js"
compatibility_date = "2025-06-12"

[assets]
directory = "./dist"
binding = "ASSETS"
not_found_handling = "single-page-application"

# =============================================================================
# PRODUCTION ENVIRONMENT
# =============================================================================
# Deploy with: pnpm cf-deploy production
# Config from: .env.production
# =============================================================================
[env.production]
name = "simpletodo-prod-test"

[[env.production.routes]]
pattern = "simpletodo-test.primitive.app"
custom_domain = true

[env.production.vars]
# Auth proxy cookie settings (worker-specific)
REFRESH_PROXY_COOKIE_MAX_AGE = "604800"
REFRESH_PROXY_COOKIE_PATH = "/proxy/"

# Billing defaults (STRIPE_PRICE_ID and APP_URL come from .env.production via deploy script)
TRIAL_DAYS = "0"

# Note: APP_ID and API_ORIGIN are read from .env.production by the deploy script
# and passed to wrangler via --var flags. Do not duplicate them here.
# Note: STRIPE_SECRET_KEY and STRIPE_WEBHOOK_SECRET must be set as secrets:
#   wrangler secret put STRIPE_SECRET_KEY --env production
#   wrangler secret put STRIPE_WEBHOOK_SECRET --env production

# Billing KV namespace â€” create with:
#   wrangler kv namespace create BILLING_KV --env production
# Then paste the id below.
[[env.production.kv_namespaces]]
binding = "BILLING_KV"
id = "47015aef503941e8a69fecf9ba4c1148"

# =============================================================================
# ADDITIONAL ENVIRONMENTS
# =============================================================================
# To add a test environment:
#
# 1. Add a section here:
#    [env.test]
#    name = "YOUR APP NAME HERE-test"
#    [env.test.vars]
#    REFRESH_PROXY_COOKIE_MAX_AGE = "604800"
#    REFRESH_PROXY_COOKIE_PATH = "/proxy/"
#
# 2. Create .env.test with your test configuration
#
# 3. Deploy with: pnpm cf-deploy test
